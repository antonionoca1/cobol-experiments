IDENTIFICATION DIVISION.
PROGRAM-ID. PRINT-NAMES.
ENVIRONMENT DIVISION.
INPUT-OUTPUT SECTION.
FILE-CONTROL.
    SELECT CSV-FILE ASSIGN TO "sample.csv"
        ORGANIZATION IS LINE SEQUENTIAL.
DATA DIVISION.
FILE SECTION.
FD  CSV-FILE.
01  CSV-RECORD        PIC X(80).
WORKING-STORAGE SECTION.
01  WS-FIRST-NAME     PIC X(20).
01  WS-SURNAME        PIC X(20).
01  WS-DOB            PIC X(10).
01  WS-TAB-POS1       PIC 9(2) VALUE 0.
01  WS-TAB-POS2       PIC 9(2) VALUE 0.
01  WS-TAB-POS3       PIC 9(2) VALUE 0.
01  WS-LINE-LEN       PIC 9(2) VALUE 0.
01  WS-I              PIC 9(2) VALUE 0.
01  WS-CHAR           PIC X(1).
01  WS-FIRST-LEN      PIC 9(2) VALUE 0.
01  WS-SURNAME-LEN    PIC 9(2) VALUE 0.
01  WS-SURNAME-START  PIC 9(2) VALUE 0.
01  WS-DOB-START      PIC 9(2) VALUE 0.
01  WS-DOB-LEN        PIC 9(2) VALUE 0.
01  WS-YEAR           PIC 9(4) VALUE 0.
01  WS-MONTH          PIC 9(2) VALUE 0.
01  WS-DAY            PIC 9(2) VALUE 0.
01  WS-AGE            PIC 9(3) VALUE 0.
01  WS-CURR-YEAR      PIC 9(4) VALUE 2025.
01  WS-CURR-MONTH     PIC 9(2) VALUE 7.
01  WS-CURR-DAY       PIC 9(2) VALUE 15.
01  EOF-FLAG          PIC X VALUE 'N'.
    88  EOF-REACHED   VALUE 'Y'.
    88  NOT-EOF       VALUE 'N'.
PROCEDURE DIVISION.
    OPEN INPUT CSV-FILE.
    PERFORM UNTIL EOF-REACHED
        READ CSV-FILE
            AT END
                SET EOF-REACHED TO TRUE
            NOT AT END
                PERFORM EXTRACT-NAMES
        END-READ
    END-PERFORM
    CLOSE CSV-FILE.
    STOP RUN.
EXTRACT-NAMES.
    MOVE 0 TO WS-TAB-POS1 WS-TAB-POS2 WS-TAB-POS3 WS-LINE-LEN WS-I.
    MOVE SPACE TO WS-FIRST-NAME WS-SURNAME WS-DOB.
    INSPECT CSV-RECORD TALLYING WS-LINE-LEN FOR CHARACTERS.
    PERFORM VARYING WS-I FROM 1 BY 1 UNTIL WS-I > WS-LINE-LEN
        MOVE CSV-RECORD(WS-I:1) TO WS-CHAR
        IF WS-CHAR = X'09' AND WS-TAB-POS1 = 0
            MOVE WS-I TO WS-TAB-POS1
        ELSE IF WS-CHAR = X'09' AND WS-TAB-POS1 > 0 AND WS-TAB-POS2 = 0
            MOVE WS-I TO WS-TAB-POS2
        ELSE IF WS-CHAR = X'09' AND WS-TAB-POS2 > 0 AND WS-TAB-POS3 = 0
            MOVE WS-I TO WS-TAB-POS3
        END-IF
    END-PERFORM
    IF WS-TAB-POS1 > 1
        COMPUTE WS-FIRST-LEN = WS-TAB-POS1 - 1
        MOVE CSV-RECORD(1:WS-FIRST-LEN) TO WS-FIRST-NAME
    END-IF
    IF WS-TAB-POS2 > WS-TAB-POS1 + 1
        COMPUTE WS-SURNAME-START = WS-TAB-POS1 + 1
        COMPUTE WS-SURNAME-LEN = WS-TAB-POS2 - WS-TAB-POS1 - 1
        MOVE CSV-RECORD(WS-SURNAME-START:WS-SURNAME-LEN) TO WS-SURNAME
    END-IF
    IF WS-TAB-POS3 > WS-TAB-POS2 + 1
        COMPUTE WS-DOB-START = WS-TAB-POS2 + 1
        COMPUTE WS-DOB-LEN = WS-TAB-POS3 - WS-TAB-POS2 - 1
        MOVE CSV-RECORD(WS-DOB-START:WS-DOB-LEN) TO WS-DOB
    END-IF
    PERFORM CALCULATE-AGE
    DISPLAY WS-FIRST-NAME " " WS-SURNAME " " WS-AGE.
CALCULATE-AGE.
    MOVE WS-DOB(1:4) TO WS-YEAR
    MOVE WS-DOB(6:2) TO WS-MONTH
    MOVE WS-DOB(9:2) TO WS-DAY
    COMPUTE WS-AGE = WS-CURR-YEAR - WS-YEAR
    IF WS-CURR-MONTH < WS-MONTH OR
       (WS-CURR-MONTH = WS-MONTH AND WS-CURR-DAY < WS-DAY)
        SUBTRACT 1 FROM WS-AGE
    END-IF